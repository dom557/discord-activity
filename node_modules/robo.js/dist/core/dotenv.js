import { existsSync, readFileSync } from 'node:fs';
import { readFile } from 'node:fs/promises';
import v from 'node:path';
import { IS_BUN } from '../cli/utils/runtime-utils.js';

function p(c){const i=c.split(`
`),a=/^\s*#/,o=/^['"]/,l=/\\(.)/g;let e="";const n={};for(let s=0;s<i.length;s++){if(e+=i[s],a.test(e)){e="";continue}if(e.endsWith("\\")){e=e.slice(0,-1);continue}const r=e.indexOf("=");if(r===-1){e="";continue}const f=e.substr(0,r).trim();let t=e.substr(r+1).trim();o.test(t)&&(t=t.slice(1,-1).replace(l,"$1")),n[f]=t,e="";}return n}async function b(c={}){if(IS_BUN)return;const{filePath:i=v.join(process.cwd(),".env")}=c;if(!existsSync(i))return;const a=c.sync?readFileSync(i,"utf-8"):await readFile(i,"utf-8"),o=p(a),l=/\${(.+?)}/g,e={...process.env};try{for(const n in o){if(n in e)continue;const s=new Set;let r=o[n];for(;l.test(r);)r=r.replace(l,(f,t)=>{if(s.has(t))throw new Error(`Circular reference detected in environment variable "${n}"`);return s.add(t),e[t]||o[t]||""});e[n]=r;}Object.assign(process.env,e);}catch(n){console.error("Error while loading environment variables:",n);}}

export { b as loadEnv };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=dotenv.js.map